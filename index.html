<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Transform your messages into Martha Scott styled Baby Reindeer messages."
    />
    <meta
      name="keywords"
      content="babyreindeerify, babyreindeer, babyreindeerify messages, babyreindeerify text"
    />
    <title>babyreindeerify</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-PV3S2MV");
    </script>
    <!-- End Google Tag Manager -->
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-PV3S2MV"
        height="0"
        width="0"
        style="display: none; visibility: hidden"
      ></iframe
    ></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div class="mx-auto py-12 px-4 max-w-2xl font-mono">
      <h1 class="mb-3 font-medium text-3xl text-red-600">babyreindeerify</h1>

      <label
        for="message"
        class="block text-sm font-medium leading-6 text-gray-900"
        >entre a mesasge to babyreindeerify</label
      >
      <div class="mt-2">
        <textarea
          rows="4"
          name="message"
          id="message"
          class="block w-full rounded-md border-0 px-3 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
        ></textarea>

        <div class="relative flex items-start mt-2">
          <div class="flex h-6 items-center">
            <input
              id="iphone"
              name="iphone"
              type="checkbox"
              class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600"
              checked
            />
          </div>
          <div class="ml-3 text-sm leading-6">
            <label for="iphone" class="font-medium text-gray-900"
              >add ipnhe sign-off mesasge</label
            >
          </div>
        </div>

        <button
          id="submit"
          class="rounded-md w-full block bg-red-600 px-2.5 py-3.5 mt-3 text-sm font-semibold text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"
        >
          babyreindeerify
        </button>
      </div>
      <div id="output" class="hidden border p-3 mt-6 rounded-md relative">
        <div class="absolute top-3 right-3">
          <button id="email" class="mr-2" title="Email">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 512 512"
              width="20"
              height="20"
            >
              <path
                d="M64 112c-8.8 0-16 7.2-16 16v22.1L220.5 291.7c20.7 17 50.4 17 71.1 0L464 150.1V128c0-8.8-7.2-16-16-16H64zM48 212.2V384c0 8.8 7.2 16 16 16H448c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0L48 212.2zM0 128C0 92.7 28.7 64 64 64H448c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128z"
              />
            </svg>
          </button>

          <button id="copy" title="Copy to clipboard">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 448 512"
              width="20"
              height="20"
            >
              <path
                d="M384 336H192c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16l140.1 0L400 115.9V320c0 8.8-7.2 16-16 16zM192 384H384c35.3 0 64-28.7 64-64V115.9c0-12.7-5.1-24.9-14.1-33.9L366.1 14.1c-9-9-21.2-14.1-33.9-14.1H192c-35.3 0-64 28.7-64 64V320c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H256c35.3 0 64-28.7 64-64V416H272v32c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192c0-8.8 7.2-16 16-16H96V128H64z"
              />
            </svg>
          </button>
        </div>

        <div id="output-message"></div>
      </div>

      <div class="text-center mt-3">
        <a
          href="https://github.com/Markshall/babyreindeerify"
          target="_blank"
          class="inline-block text-gray-500 text-sm font-medium hover:text-gray-700"
          >GitHub</a
        >
      </div>
    </div>

    <script>
      const babyReindeerify = (message, iphoneMessage = false) => {
        const words = message.split(" ");
        let response = [];

        for (const word of words) {
          const malformedWord = malformWord(word);

          response.push(malformedWord.toLowerCase());
        }

        if (iphoneMessage) {
          const msg =
            (Math.random() % 2 > 0.5 ? "<br /><br />" : "") +
            malformWord(getIphoneMessage());
          response.push(Math.random() % 2 > 0.5 ? msg : msg.toLowerCase());
        }

        return response.join(" ");
      };

      const malformWord = (word) => {
        // bail if the word is too short
        if (word.length <= 3) {
          return word;
        }

        const letters = [...word];

        // conditionally remove a random letter, but not the 1st letter
        if (Math.random() % 2 > 0.5 || word.length > 5) {
          const idx = randomNumber(1, word.length + 1);
          const letter = letters[idx];
          if (letter !== "\n") {
            letters.splice(idx, 1);
          }
        }

        let malformedWord = letters.join("");

        // conditionally swap 2 letters that are next to each other
        if (Math.random() % 2 > 0.25 && word.length > 4) {
          malformedWord = swapRandomLetters(letters).join("");
        }

        return malformedWord;
      };

      const swapRandomLetters = (letters) => {
        // get a random letter position, and then the letter next to it
        const swapLetter1 = randomNumber(0, letters.length - 1);
        const swapLetter2 = swapLetter1 + 1;

        // destructure array to swap letters
        [letters[swapLetter1], letters[swapLetter2]] = [
          letters[swapLetter2],
          letters[swapLetter1],
        ];

        return letters;
      };

      const getIphoneMessage = () => {
        const messages = ["Sent from iPhone", "Sent from my iPhone", "iPhone"];
        const message = messages[randomNumber(0, messages.length)];

        return message;
      };

      const randomNumber = (min, max) =>
        Math.floor(Math.random() * (max - min) + min);

      document.querySelector("#submit").addEventListener("click", (e) => {
        e.preventDefault();

        const message = document.querySelector("textarea").value;
        const outputEl = document.querySelector("#output");

        if (!message) {
          outputEl.classList.add("hidden");
          return;
        }

        const babyreindeerified = babyReindeerify(
          message,
          document.querySelector("#iphone").checked
        );

        outputEl.classList.remove("hidden");
        outputEl.querySelector("#output-message").innerHTML =
          babyreindeerified.replace(/\n/g, "<br />");
      });

      document.querySelector("#copy").addEventListener("click", () => {
        const el = document.createElement("textarea");
        el.value = document.querySelector("#output-message").innerText;
        document.body.appendChild(el);
        el.select();
        document.execCommand("copy");
        document.body.removeChild(el);
        alert("Copied to clipboard!");
      });

      document.querySelector("#email").addEventListener("click", () => {
        const message = document
          .querySelector("#output-message")
          .innerText.replace(/\n/g, "%0A");
        const subject = "babyreindeerify";
        const body = message;

        window.location.href = `mailto:?subject=${subject}&body=${body}`;
      });
    </script>
  </body>
</html>
